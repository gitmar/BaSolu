<!-- Components/ChildEntityList.razor -->
<h5>Child Entities</h5>

@foreach (var child in Items)
{
    <div class="d-flex align-items-center mb-2">
        <span>@child.Label</span>
        <button class="btn btn-sm btn-outline-primary ms-2" @onclick="() => OnEdit.InvokeAsync(child)">Edit</button>
        <button class="btn btn-sm btn-outline-danger ms-1" @onclick="() => OnDelete.InvokeAsync(child)">Delete</button>
    </div>
}

<button class="btn btn-success mt-2" @onclick="OnAdd">Add Child</button>

@if (EditingChild != null)
{
    <ChildEntityForm Model="@EditingChild"
                     OnSave="HandleChildSave"
                     OnCancel="CancelEdit" />
}

@code {
    [Parameter] public List<ChildDto> Items { get; set; } = new();
    [Parameter] public EventCallback<ChildDto> OnEdit { get; set; }
    [Parameter] public EventCallback<ChildDto> OnDelete { get; set; }
    [Parameter] public EventCallback OnAdd { get; set; }

    private ChildDto? EditingChild;

    private void HandleChildSave(ChildDto updated)
    {
        var index = Items.FindIndex(c => c.Id == updated.Id);
        if (index >= 0) Items[index] = updated;
        else Items.Add(updated);
        EditingChild = null;
    }

    private void CancelEdit() => EditingChild = null;
}