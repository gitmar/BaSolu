@page "/puzzlehubrazor"

@using GxTie.Services
@using GxTie.Services

@inject IPuzzleSyncService PuzzleSyncService

@code {
    protected override async Task OnInitializedAsync()
    {
        await PuzzleSyncService.SyncPuzzleStateAsync();
    }
    public async Task OpenPuzzleAsync()
    {
        // before sensitive actions 
        var isFresh = await PuzzleSyncService.EnsureSessionIsFreshAsync();
        if (!isFresh)
        {
            // Optionally redirect to login or show session expired message
            return;
        }
        // on timer or background sync
        var timer = new System.Timers.Timer(300000); // every 5 minutes
        timer.Elapsed += async (_, __) => await PuzzleSyncService.SyncPuzzleStateAsync();
        timer.Start();
        // on re-authentication or token refresh
        await PuzzleSyncService.SyncPuzzleStateAsync();
    }
}
