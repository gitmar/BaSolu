@using GxStk.Services
@using GxShared.GlobModels
@using BlazorBootstrap
@using System.Security.Claims

@inject NavigationManager _navManager

<div class="top-row navbar navbar-dark bg-success shadow-sm bg-opacity-25">
    <a class="navbar-brand text-white fw-bold" href="">Gx-Solutions</a>
    <span class="text-warning fw-bold">(Stock)</span>
    @* <button class="navbar-toggler" type="button" @onclick="ToggleNavMenu">
        <span class="navbar-toggler-icon"></span>
    </button> *@
</div>

<div class="@NavMenuCssClass bg-dark vh-100" style="overflow-y: auto;">
    <nav class="nav flex-column">
        <NavLink class="nav-link nav-main text-light small" href="" Match="NavLinkMatch.All">
            <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> Home
         </NavLink>
        @* <div class="@(isOpen ? "d-none" : "")">
            <Login OnAdmLoginChanged="HandleAdmLoginChanged" />
        </div> *@
        <AuthorizeView>
            <Authorized>
                <NavLink class="nav-link nav-main text-light small" @onclick="ToggleSubManag">
                    <Icon Name="IconName.PlusSquareFill" Size="IconSize.x5" Color="IconColor.White" /> &nbsp; Gestion
                </NavLink>
                @if (isSubManagVisible)
                {
                    <nav class="nav flex-column">
                            <NavLink class="nav-link nav-sub text-light small" href="enrolmenu">
                                <Icon Name="IconName.CaretRightSquare" /> &nbsp; Reception
                            </NavLink>
                        <NavLink class="nav-link nav-sub text-light small" href="carrimenu">
                                <Icon Name="IconName.CaretRightSquare" /> &nbsp; Mouvement
                            </NavLink>
                        <NavLink class="nav-link nav-sub text-light small" href="subitem3">
                                <Icon Name="IconName.CaretRightSquare" /> &nbsp; Editions
                            </NavLink>
                    </nav>
                }
                <NavLink class="nav-link nav-main text-light small" @onclick="ToggleSubOper">
                        <Icon Name="IconName.PlusSquareFill" Size="IconSize.x5" Color="IconColor.White" /> &nbsp; Operations
                    </NavLink>
                @if (isSubOperVisible)
                {
                    <nav class="nav flex-column">
                        <NavLink class="nav-link nav-sub text-light small" href="saieactlnes">
                                <Icon Name="IconName.CaretRightSquare" /> &nbsp; Achats
                            </NavLink>
                        <NavLink class="nav-link nav-sub text-light small" href="saieactlnes">
                                <Icon Name="IconName.CaretRightSquare" /> &nbsp; Ventes
                            </NavLink>
                        <NavLink class="nav-link nav-sub text-light small" href="calcreslnes">
                                <Icon Name="IconName.CaretRightSquare" /> &nbsp; Calculs
                            </NavLink>
                        <NavLink class="nav-link nav-sub text-light small" href="subitem3">
                                <Icon Name="IconName.CaretRightSquare" /> &nbsp; Editions
                            </NavLink>
                    </nav>
                }
                <NavLink class="nav-link nav-main text-light" href="about">
                    <i class="bi bi-key me-2" aria-hidden="true"></i> Analyses
                </NavLink>
            </Authorized>
        </AuthorizeView>
        <NavLink class="nav-link nav-main text-light" href="about">
            <i class="bi bi-calendar3 me-2" aria-hidden="true"></i> Agendas
        </NavLink>
        <NavLink class="nav-link nav-main text-light" href="about">
            <i class="bi bi-info-circle-fill me-2" aria-hidden="true"></i> About
        </NavLink>
    </nav>
</div>
<style>
    .nav-link.active {
        background-color: #0d6efd !important;
        color: white !important;
        font-weight: 600;
        border-radius: 0.3rem;
    }

    .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color: #fff;
    }

    .nav-main {
        margin-left: 1rem; /* Main items slightly indented */
    }

    .nav-sub {
        margin-left: 2rem; /* Subitems more indented */
    }
</style>
@code {
    [CascadingParameter]
    private Task<AuthenticationState>? AuthState { get; set; }
    private bool isOwner = false;
    private ClaimsPrincipal authUser;
    private bool isAuthenticated = false;
    private bool success, errors, isSubmitting = false;
    private string[] errorList = [];
    private bool collapseNavMenu = false;
    private string? NavMenuCssClass => collapseNavMenu ? "collapse" : null;

    private bool siOpera=false, siAdmin = false, siStock = true;
    private int IMyAcc = 2;
    private bool isSubManagVisible = false;
    private bool isSubSecuVisible = false;
    private bool isSubOperVisible = false;
    private bool isSubParaVisible = false;
    private bool isSubProgVisible = false;
    //private void ToggleNavMenu() => collapseNavMenu = !collapseNavMenu;
    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthState;
        authUser = authState.User;
        isAuthenticated = authUser.Identity.IsAuthenticated;
        if (!isAuthenticated)
        {
            Console.WriteLine("Authentication Utilisateur ECHEC");
            return;
        }
        else
        {
            Console.WriteLine("Authentication MainMenu SUCCESS");
        }
        //_appState.OnChange += StateHasChanged;
    }
    public void Dispose()
    {
        //_appState.OnChange -= StateHasChanged;
    }
    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }
    private void ToggleSubManag()
    {
        isSubManagVisible = !isSubManagVisible;
    }
    private void ToggleSubSecu()
    {
        isSubSecuVisible = !isSubSecuVisible;
    }
    private void ToggleSubOper()
    {
        isSubOperVisible = !isSubOperVisible;
    }

    //Admin
    private void ToggleSubPara()
    {
        isSubParaVisible = !isSubParaVisible;
    }
    private void ToggleSubProg()
    {
        isSubProgVisible = !isSubProgVisible;
    }
    private bool Entest = false;
}
